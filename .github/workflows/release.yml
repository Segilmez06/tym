name: Release

on:
    push:
        branches:
            - main
            - dev

jobs:
    draft-release:
        name: Draft new release
        runs-on: ubuntu-latest

        outputs:
            upload_url: ${{ steps.draft_release.outputs.upload_url }}

        steps:
    
            - name: Fetch source code
              uses: actions/checkout@3

            - name: Install XML tools
              run: sudo apt install xmlstarlet
              
            - name: Fetch version string
              run: echo "TAG=$(xmlstarlet select --template --value-of /Project/PropertyGroup/AssemblyVersion ./src/TYM.csproj)" >> $GITHUB_OUTPUT
              id: project_version

            - name: Draft release
              uses: actions/create-release@v1
              id: draft_release
              env:
                GITHUB_TOKEN: ${{ secrets.G_TOKEN }}
              with:
                tag_name: ${{ steps.project_version.outputs.TAG }}
                release_name: TYM v${{ steps.project_version.outputs.TAG }}
                draft: true
                prerelease: false